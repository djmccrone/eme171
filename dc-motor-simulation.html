<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  DC Motor Simulation | EME 171: Analysis, Simulation and Design of Mechatronic Systems
</title>
  <link rel="canonical" href="https://moorepants.github.io/eme171/dc-motor-simulation.html">


  <link rel="stylesheet" href="https://moorepants.github.io/eme171/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/eme171/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/eme171/theme/css/pygments/emacs.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/eme171/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://moorepants.github.io/eme171/feeds/all.atom.xml">
  
  <meta name="description" content="This Matlab/Octave file demonstrates a simulation of a simple DC motor model simulation. simulate_dc_motor.m This is a basic simulation of the first order ordinary differential equations of a DC motor with a specified voltage. In class, we wrote each of the three functions as separate files, but you â€¦">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-15966419-8', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://moorepants.github.io/eme171/">EME 171: Analysis, Simulation and Design of Mechatronic Systems</a></h1>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme171/">Syllabus</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme171/schedule.html">Schedule</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme171/resources.html">Resources</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  DC Motor Simulation
</h1>
      <hr>

<article class="article">
  <div class="content">
    <p>This Matlab/Octave file demonstrates a simulation of a simple DC motor model
simulation.</p>
<div class="section" id="simulate-dc-motor-m">
<h2>simulate_dc_motor.m</h2>
<p>This is a basic simulation of the first order ordinary differential equations
of a DC motor with a specified voltage. In class, we wrote each of the three
functions as separate files, but you can include them all in one file as shown
below. To run this file, download it, set your Octave/Matlab path to the
directory where the file is and type <cite>simulate_dc_motor</cite> in the Octave/Matlab
terminal window.</p>
<p><a class="reference external" href="https://moorepants.github.io/eme171/scripts/simulate_dc_motor.m">Download simulate_dc_motor.m</a></p>
<div class="highlight"><pre class="code matlab highlight literal-block">
<span class="c">%% This file demonstrates how to do basic simulation of the first order</span>
<span class="c">%% differential % equations of a simple DC motor model.</span>

<span class="c">% This file contains three functions. The first function in the file will be</span>
<span class="c">% the primary function that calls the other two functions defined below.</span>
<span class="k">
function</span><span class="w"> </span><span class="nf">simulate_dc_motor</span><span class="p">()</span><span class="w">
    </span><span class="c">% The system has four state variables and here the initial condition for</span>
    <span class="c">% each state variable is set. Feel free to try out different initial</span>
    <span class="c">% conditions.</span>
    <span class="c">% x = [q, i, theta, omega]</span>
    <span class="n">x0</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>

    <span class="c">% Create a vector of time values that we desire to know x(t) at. The</span>
    <span class="c">% larger the number of values, the more accurate the result is, but the</span>
    <span class="c">% slower the integration runs. Try changing the time step (deltat) to</span>
    <span class="c">% see the affects on the results.</span>
    <span class="n">t</span> <span class="p">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>

    <span class="c">% Call a function that integrates the system's equations and returns</span>
    <span class="c">% x(t).</span>
    <span class="c">% The &#64; is required to pass in functions to other functions, i.e. a</span>
    <span class="c">% function name is not a standard variable name.</span>
    <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="n">euler_integrate</span><span class="p">(&#64;</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x0</span><span class="p">);</span>

    <span class="c">% Plot the results. Always label x and y axis and provide units! Note</span>
    <span class="c">% that Octave/Matlab can render mathematical symbols using LaTeX</span>
    <span class="c">% notation.</span>
    <span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="n">title</span><span class="p">(</span><span class="s">'Simulation with Euler''s Method'</span><span class="p">);</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">'Time [s]'</span><span class="p">);</span>
    <span class="n">legend</span><span class="p">(</span><span class="s">'q [C]'</span><span class="p">,</span> <span class="s">'i [A]'</span><span class="p">,</span> <span class="s">'\theta [rad]'</span><span class="p">,</span> <span class="s">'\omega [rad/s]'</span><span class="p">);</span>

    <span class="c">% We wrote our own integration function here, but Octave/Matlab includes</span>
    <span class="c">% many better integration routines that can handle certain ODEs more</span>
    <span class="c">% carefully, ensuring accurate results. For example ode45() works just</span>
    <span class="c">% like euler_integrate() but uses the Runga-Kutta 4-5 integration</span>
    <span class="c">% algorithm. This is a good algorithm for most non-stiff system</span>
    <span class="c">% equations and will work with most of the models in this class. You use</span>
    <span class="c">% it like so:</span>
    <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="n">ode45</span><span class="p">(&#64;</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x0</span><span class="p">);</span>

    <span class="c">% You should get almost exactly the same results as the custom</span>
    <span class="c">% integration function:</span>
    <span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="n">title</span><span class="p">(</span><span class="s">'Simulation with Octave/Matlab''s Runga-Kutta 4-5 Method'</span><span class="p">);</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">'Time [s]'</span><span class="p">);</span>
    <span class="n">legend</span><span class="p">(</span><span class="s">'q [C]'</span><span class="p">,</span> <span class="s">'i [A]'</span><span class="p">,</span> <span class="s">'\theta [rad]'</span><span class="p">,</span> <span class="s">'\omega [rad/s]'</span><span class="p">);</span>
<span class="n">end</span>

<span class="s">function</span> <span class="s">[t,</span> <span class="s">x]</span> <span class="s">=</span> <span class="s">euler_integrate(f,</span> <span class="s">t,</span> <span class="s">x0)</span><span class="p"></span>
    <span class="c">% EULER_INTEGRATE - Integrates a set of first order ordinary</span>
    <span class="c">% differential equations using Euler's integration method.</span>
    <span class="c">%</span>
    <span class="c">% Syntax: [t, x] = euler_integrate(f, t, x0)</span>
    <span class="c">%</span>
    <span class="c">% Inputs:</span>
    <span class="c">%   f - An anonymous function that evaluates the right hand side of the</span>
    <span class="c">%       first order ordinary differential equations, i.e. dx/dt. The</span>
    <span class="c">%       function must follow the syntax dxdt = f(t, x) and return a size</span>
    <span class="c">%       1xm vector where t is size 1x1 and x is size 1xm.</span>
    <span class="c">%   t - Vector of monotonically increasing time values. [size 1xn]</span>
    <span class="c">%   x0 - Vector a initial conditions for the states. [size 1xm]</span>
    <span class="c">% Outputs:</span>
    <span class="c">%   t - Vector of monotonically increasing time values (same as the</span>
    <span class="c">%       input t). [size 1xn]</span>
    <span class="c">%   x - Matrix of state values as a function of time. [size nxm]</span>

    <span class="c">% Create an &quot;empty&quot; matrix to hold the results n x m.</span>
    <span class="n">x</span> <span class="p">=</span> <span class="nb">nan</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nb">length</span><span class="p">(</span><span class="n">x0</span><span class="p">));</span>

    <span class="c">% Set the initial conditions to the first element.</span>
    <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">:)</span> <span class="p">=</span> <span class="n">x0</span><span class="p">;</span>

    <span class="c">% Use a for loop to sequentially calculate each new x.</span>
    <span class="n">for</span> <span class="s">i</span> <span class="s">=</span> <span class="s">2:length(t)</span><span class="p"></span>
        <span class="n">deltat</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">x</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:)</span> <span class="o">+</span> <span class="n">deltat</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:));</span>
    <span class="n">end</span>

<span class="s">end</span><span class="p"></span>
<span class="k">
function</span><span class="w"> </span>xdot <span class="p">=</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span>t, x<span class="p">)</span><span class="w">
    </span><span class="c">% F - Returns the time derivative of the states.</span>
    <span class="c">%</span>
    <span class="c">% Syntax: xdot = f(t, x)</span>
    <span class="c">%</span>
    <span class="c">% Inputs:</span>
    <span class="c">%   t - A scalar value of time, size 1x1.</span>
    <span class="c">%   x - State vector at time t, size 1xm were m is the number of states.</span>
    <span class="c">% Outputs:</span>
    <span class="c">%   xdot - Time derivative of the states at time t, size 1xm.</span>

    <span class="c">% Extract the state variables so we can use the variable names we want.</span>
    <span class="n">q</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nb">i</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">theta</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">omega</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

    <span class="c">% Declare the constants. Make sure units are compatible!</span>
    <span class="n">L</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>  <span class="c">% motor inductance [H]</span>
    <span class="n">Rw</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>  <span class="c">% motor winding resistance [Ohm]</span>
    <span class="n">ktau</span> <span class="p">=</span> <span class="mf">1.5</span><span class="p">;</span>  <span class="c">% motor torque constant [N*m/A]</span>
    <span class="n">b</span> <span class="p">=</span> <span class="mf">1.8</span><span class="p">;</span>  <span class="c">% Rotor viscous friction [N*m*s]</span>
    <span class="n">J</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>  <span class="c">% Rotor inertia [kg*m^2]</span>

    <span class="c">% Initialize the empty vector for the derivative of the states. [1xm]</span>
    <span class="n">xdot</span> <span class="p">=</span> <span class="nb">nan</span> <span class="o">*</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>

    <span class="c">% The voltage is the source effort in this system. So we can specify what we</span>
    <span class="c">% want it to be.</span>
    <span class="c">% Example 1, constant voltage:</span>
    <span class="n">V</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">% Uncomment the following two examples to try them out.</span>
    <span class="c">% Example 2, sinusoidal voltage (function of time):</span>
    <span class="c">%V = 0.5*sin(pi*t);</span>
    <span class="c">% Example 3, voltage switches on at 1 second (also function of time):</span>
<span class="c">%    if t &lt; 1</span>
<span class="c">%        V = 0;</span>
<span class="c">%    else</span>
<span class="c">%        V = 0.5;</span>
<span class="c">%    end</span>

    <span class="c">% Fill the derivative entries based on the system's equations.</span>
    <span class="n">xdot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="nb">i</span><span class="p">;</span>
    <span class="n">xdot</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="o">-</span><span class="n">Rw</span><span class="o">*</span><span class="nb">i</span> <span class="o">-</span> <span class="n">ktau</span><span class="o">*</span><span class="n">omega</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span><span class="p">;</span>
    <span class="n">xdot</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">=</span> <span class="n">omega</span><span class="p">;</span>
    <span class="n">xdot</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">omega</span> <span class="o">+</span> <span class="n">ktau</span><span class="o">*</span><span class="nb">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">J</span><span class="p">;</span>

<span class="n">end</span>

</pre>
</div></div>

  </div>
</article>


    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://moorepants.github.io/eme171/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://moorepants.github.io/eme171/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://moorepants.github.io/eme171/categories.html">Categories</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>
<div class="row">
  <div class="col-sm-4 mx-auto text-center text-muted" >
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
  </div>
</div>    </div>
  </footer>
</body>

</html>